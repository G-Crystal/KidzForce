var config={apiKey:"AIzaSyBhxSeZh75dG3_3fuIdXzivdbU_ue2NC9g",authDomain:"kidzbiz101-9e406.firebaseapp.com",databaseURL:"https://kidzbiz101-9e406.firebaseio.com",storageBucket:"kidzbiz101-9e406.appspot.com",messagingSenderId:"339595614369"};firebase.initializeApp(config),angular.module("kb",["ionic","ngIOS9UIWebViewPatch","kb.controllers","ngMessages","ngCordova","kb.constant","ionic.rating","firebase","ngCordovaOauth","ngStorage","mgo-angular-wizard","ionic-datepicker","ionic-timepicker","ngAnimate","onezone-datepicker","ui.mask","uiGmapgoogle-maps"]).filter("capitalize",function(){return function(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}}).filter("capitalizeWords",function(){function e(e){if(e=e.toLowerCase(),null!==e)return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}return e}).directive("onValidSubmit",["$parse","$timeout",function(e,o){return{require:"^form",restrict:"A",link:function(o,t,n,r){r.$submitted=!1;var i=e(n.onValidSubmit);t.on("submit",function(e){o.$apply(function(){t.addClass("ng-submitted"),r.$submitted=!0,r.$valid&&"function"==typeof i&&i(o,{$event:e})})})}}}]).directive("validated",["$parse",function(e){return{restrict:"AEC",require:"^form",link:function(e,o,t,n){for(var r=o.find("*"),i=0;i<r.length;i++)!function(t){var r=t.attributes;if(void 0!=r.getNamedItem("ng-model")&&void 0!=r.getNamedItem("name")){var i=n[r.name.value];void 0!=i&&e.$watch(function(){return n.$submitted+"_"+i.$valid},function(){if(1==n.$submitted){var e=angular.element(t);e.hasClass("ng-invalid")?(o.removeClass("has-success"),o.addClass("has-error")):o.removeClass("has-error").addClass("has-success")}})}}(r[i])}}}]).directive("dynamic",function(e){return{restrict:"A",replace:!0,link:function(o,t,n){o.$watch(n.dynamic,function(n){t.html(n),e(t.contents())(o)})}}}).directive("onFileChange",function(){return{restrict:"A",link:function(e,o,t){var n=e.$eval(t.onFileChange);o.bind("change",function(){e.$apply(function(){var e=o[0].files;e&&n(e)})})}}}).run(function(e,o,t,n,r,i,a,c,s,l,d,p,u,m){function h(e){console.log("keyboard showing"),cordova.plugins.Keyboard.disableScroll(!1),document.body.classList.add("keyboard-open")}function f(e){cordova.plugins.Keyboard.disableScroll(!0),document.body.classList.remove("keyboard-open")}var g=c.$default({first_run:!0});if(window.isBrowserMode||(g.first_run?(c.first_run=!1,n.go("intro")):n.go("login")),window.addEventListener("native.keyboardshow",h),window.addEventListener("native.keyboardhide",f),o.isBrowserMode=window.isBrowserMode,window.isBrowserMode||(r.fromTemplateUrl("templates/no-connection/no-connection.html",{scope:o}).then(function(e){o.noConnectionModal=e}),o.showNoConnectionDialog=function(){o.noConnectionModal.show()},o.hideNoConnectionDialog=function(){o.noConnectionModal.hide()}),window.isBrowserMode||(o.$on("$cordovaNetwork:online",function(e,t){console.log("cordovaNetwork:online => "+t),o.hideNoConnectionDialog()}),o.$on("$cordovaNetwork:offline",function(e,t){console.log("cordovaNetwork:offline => "+t),o.showNoConnectionDialog()})),o.hasCheckIn=!1,o.checkIn={},o.modal=null,o.verifyIdentityModal=null,o.loggedIn=!1,null!=firebase.auth().currentUser&&("undefined"==typeof c.uid&&""==c.uid&&(c.uid=firebase.auth().currentUser.uid),o.loggedIn=!0),window.isBrowserMode){if((location.pathname.indexOf("dashboard")>-1||location.pathname.indexOf("chores")>-1||location.pathname.indexOf("children")>-1)&&!o.loggedIn)return void(location.href="http://kidzforce.com/manage-account");if(location.pathname.indexOf("manage-account")>-1&&o.loggedIn)return void(location.href="http://kidzforce.com/dashboard")}o.showTermsOfServiceModal=function(){r.fromTemplateUrl("templates/misc/html/tos.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showAboutModal=function(){r.fromTemplateUrl("templates/misc/html/about.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showPrivacyPolicyModal=function(){r.fromTemplateUrl("templates/misc/html/privacypolicy.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.getAgeFromDob=function(e){var o=Date.now()-new Date(e).getTime(),t=new Date(o),n=Math.abs(t.getUTCFullYear()-1970);return n},o.help={title:"",message:""},o.showReportModal=function(e,t){o.help.title=e,o.help.message=t,r.fromTemplateUrl("templates/misc/html/report.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showCheckInModal=function(e){o.checkIn=e,r.fromTemplateUrl("templates/dashboard/checkin.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showHelpMeModal=function(e,t){r.fromTemplateUrl("templates/dashboard/helpme.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showProfileModal=function(){r.fromTemplateUrl("templates/dashboard/profile.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showLoginModal=function(){r.fromTemplateUrl("templates/login/html/login-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.params={email:"",password:""},o.showSignupModal=function(e,t){o.params.email=e,o.params.password=t,r.fromTemplateUrl("templates/signup/html/signup-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.verifyIdentityToAddProject=!1,o.showVerifyIdentityModal=function(){r.fromTemplateUrl("templates/signup/html/signup-identity-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.verifyIdentityModal=e,o.verifyIdentityModal.show()})},o.projectViewModal=null,o.projectViewId=0,o.showProjectViewModal=function(e){o.projectViewId=e,window.isBrowserMode?r.fromTemplateUrl("http://kidzforce.com/api/public/templates/project/view-project-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.projectViewModal=e,o.projectViewModal.show()}):r.fromTemplateUrl("templates/project/view-project-modal.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.projectViewModal=e,o.projectViewModal.show()})},o.getDateFromCalendarModal=function(e,o,t,n,i,a){e.toReturn=function(o){e.datePickerModal.hide(),a(o)},e.onezoneDatepicker={date:t,mondayFirst:!1,startDate:n,endDate:i,disablePastDays:!o,disableSwipe:!1,disableWeekend:!1,showTodayButton:!0,calendarMode:!0,hideCancelButton:!1,hideSetButton:!1,callback:e.toReturn,showDatepicker:!0};var c='<ion-modal-view><ion-header-bar><h1 class="title">Select Date</h1></ion-header-bar><ion-content><onezone-datepicker datepicker-object="onezoneDatepicker"></onezone-datepicker></ion-content></ion-modal-view>';e.datePickerModal=r.fromTemplate(c,{scope:e,animation:"slide-in-up"}),e.datePickerModal.show()},o.logout=function(){p.reset().then(function(){window.isBrowserMode?firebase.auth().signOut().then(function(){firebase.auth().currentUser=null,o.loggedIn=!1}):setTimeout(function(){n.go("login")},200)})},o.showAddProjectModal=function(){o.verifyIdentityToAddProject=!0,o.showLoader(),s.getIdentityStatus().then(function(e){"not checked"==e.passed&&o.showVerifyIdentityModal(),"failed"==e.passed&&o.showPopup("Verification failed","Please contact KidzForce we were not able to verify your identity.","error"),"passed"==e.passed&&r.fromTemplateUrl("templates/addproject.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.projectId=0,o.modal=e,o.modal.show()}),i.hide()},function(e){console.error(e)})},o.showEditProjectModal=function(e){o.projectId=e,r.fromTemplateUrl("templates/addproject.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showAddChildModal=function(){o.showLoader(),r.fromTemplateUrl("templates/addchild.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()}),i.hide()},o.childId=0,o.viewChildProfile=function(e){o.childId=e,r.fromTemplateUrl("http://ec2-107-21-160-8.compute-1.amazonaws.com/app/api/child/get?api_token="+c.uid+"&member-id="+e+"&Authorized_Member_ID="+c.uid,{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.showNotAvailable=function(){r.fromTemplateUrl("templates/not-available.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},o.$on("modal.removed",function(){}),o.$on("modal.hidden",function(){null!=document.getElementById("checkInMap")&&document.getElementById("checkInMap").remove()}),o.$on("$destroy",function(){}),e.ready(function(){if(window.cordova){var e=3e3;setTimeout(function(){navigator.splashscreen.hide()},e)}ionic.Platform.isFullScreen=!0,window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),window.cordova&&window.cordova.plugins.Keyboard,window.StatusBar&&(StatusBar.styleLightContent(),StatusBar.overlaysWebView(!1))}),o.showRatingPrompt=function(){window.cordova&&(AppRate.preferences.storeAppURL={ios:"<my_app_id>",android:"market://details?id=<package_name>"},AppRate.promptForRating())},o.showPopup=function(e,t,n){var r=l.defer();if(n="error"==n?"caution-roo-icon.svg":"success"==n?"caution-roo-icon.svg":"",""!=n)var i='<img class="roocaution" src="img/icons/'+n+'"/>';else var i="";return o.alertPopup=a.alert({template:i+"<h2>"+e+"</h2><p>"+t+"</p>",cssClass:"customPopup",scope:this}),o.alertPopup.then(function(e){console.log("alertPopup"),r.resolve("success")}),o.popupOK=function(){console.log("ok"),o.alertPopup.close(),r.resolve("success")},window.popupOK=o.popupOK,r.promise},o.showLoader=function(){i.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0,hideOnStateChange:!0})},o.isParent=function(){return!!window.isBrowserMode||"undefined"==typeof c.username&&("undefined"!=typeof c.uid?(c.uid.indexOf("-")==-1,!0):null!=firebase.auth().currentUser&&"undefined"==typeof c.child)};var w=function(e){var o=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return o},v=function(e){return w(new Date(e))},y=function(e,o){return moment(1e3*e).tz(o).toDate()};o.toUTCDate=w,o.millisToUTCDate=v,o.showLocalizedDate=y,o.build="1.3.9",o.version="1.0.0",o.main_color="#2d313f",o.saturation_value=-20,o.brightness_value=5,o.mapStyle=[{elementType:"labels",stylers:[{saturation:o.saturation_value}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"poi.government",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"poi.sport_complex",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"transit",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"transit.station",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"landscape",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"road",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]},{featureType:"water",elementType:"geometry",stylers:[{hue:o.main_color},{visibility:"on"},{lightness:o.brightness_value},{saturation:o.saturation_value}]}],o.horizontalSections=function(){var e=0;try{e=$(".sections-wrapper section").length}catch(e){}var o=$(window).width(),t=($(window).height(),$(".sections-wrapper.onepage section.active").outerHeight());null===t&&(t=$(".sections-wrapper section:first-child").outerHeight()),$(".sections-wrapper > section").css("width",o),$(".sections-wrapper").css("width",o*e),$(".sections-wrapper.onepage").css("height",t)},o.getCurrentUsername=function(){return"undefined"==typeof c.parent&&"undefined"==typeof c.child?"":o.isParent()?c.parent.name:c.child.name},o.purchaseOthers=function(){u.open("http://kidzforce.storenvy.com","_blank")},o.rooDailyDrops=function(e){m.dailyRooAvailable(e).then(function(e){console.log(e),r.fromTemplateUrl("rdd/dailydrop.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e,o.modal.show()})},function(e){console.log(e)})},ionic.keyboard.disable()}).config(function(e,o,t,n,r,i){var a={inputDate:new Date,titleLabel:"Select a Date",setLabel:"Set",todayLabel:"Today",closeLabel:"Close",mondayFirst:!1,weeksList:["S","M","T","W","T","F","S"],monthsList:["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],templateType:"popup",from:new Date(2012,8,1),to:new Date(2018,8,1),showTodayButton:!0,dateFormat:"dd MMMM yyyy",closeOnSelect:!1,disableWeekdays:[]};n.configDatePicker(a);var c={inputTime:60*(new Date).getHours()*60+60*(new Date).getMinutes(),format:12,step:15,setLabel:"Set",closeLabel:"Close"};r.configTimePicker(c),e.tabs.position("bottom"),e.spinner.icon("android"),e.views.swipeBackEnabled(!1),e.scrolling.jsScrolling(!1),e.views.forwardCache(!0),i.configure({key:"AIzaSyBCZvV8YTD4AyESm5IG-S0phuwzAKe0fmA",libraries:"places"}),window.isBrowserMode||(o.state("app",{url:"/app",abstract:!0,cache:!1,templateUrl:"templates/menu/html/menu.html",controller:"menuCtrl"}).state("about",{url:"/about",params:{isAnimated:!1},templateUrl:"templates/misc/html/about.html"}).state("tos",{url:"/tos",params:{isAnimated:!1},templateUrl:"templates/misc/html/tos.html"}).state("privacypolicy",{url:"/privacypolicy",params:{isAnimated:!1},templateUrl:"templates/misc/html/privacypolicy.html"}).state("login",{url:"/login",params:{isAnimated:!1},templateUrl:"templates/login/html/login.html",controller:"loginCtrl"}).state("app.child-dashboard",{url:"/child/dashboard",views:{"tab-child-dashboard":{templateUrl:"templates/dashboard/dashboard-feed.html"}},nativeTransitions:null,params:{isAnimated:!0}}).state("app.child-chores",{url:"/child/chores",views:{"tab-child-chores":{templateUrl:"templates/dashboard/chores.html"}},nativeTransitions:null,params:{isAnimated:!0},cache:!0}).state("app.child-earned",{url:"/child/earned",views:{"tab-child-earned":{templateUrl:"templates/dashboard/earned.html"}},nativeTransitions:null,params:{isAnimated:!0}}).state("app.report",{url:"/app/report",views:{menuContent:{templateUrl:"templates/not-available.html"}},params:{isAnimated:!0}}).state("app.parent-dashboard",{url:"/parent/dashboard",cache:!1,views:{"tab-parent-dashboard":{templateUrl:"templates/dashboard/dashboard-feed.html"}},params:{isAnimated:!0}}).state("app.parent-chores",{url:"/parent/chores",cache:!1,views:{"tab-parent-chores":{templateUrl:"templates/dashboard/chores.html"}},params:{isAnimated:!0}}).state("app.parent-children",{url:"/parent/children",cache:!1,views:{"tab-parent-children":{templateUrl:"http://ec2-107-21-160-8.compute-1.amazonaws.com/app/api/children/get?api_token=M82TBrvdHYSVBH6eDnkUmzkHSGx2&member-id=M82TBrvdHYSVBH6eDnkUmzkHSGx2&Authorized_Member_ID=M82TBrvdHYSVBH6eDnkUmzkHSGx2"}},params:{isAnimated:!0}}).state("intro",{url:"/intro",templateUrl:"templates/intro/intro.html",controller:"IntroCtrl",cache:!1}).state("roo_daily_drop",{url:"/rdd",templateUrl:"rdd/dailydrop.html",controller:"rooDailyDropController",cache:!1}),t.otherwise("/login"))});var appControllers=angular.module("kb.controllers",["ngStorage","ionic.ion.headerShrink","firebase","ngCordovaOauth","ion-google-autocomplete"]),appServices=angular.module("kb.services",[]);appControllers.factory("WordPress",["$http",function(e){var o={};return o.getPosts=function(o){return e({method:"GET",url:"http://kidzforce.com/api/get_recent_posts/?page="+o})},o.getPostsTaxonamy=function(o,t,n){return"tag"==o?e({method:"GET",url:"http://kidzforce.com/api/get_tag_posts/?page="+n+"&slug="+t}):"category"==o?e({method:"GET",url:"http://kidzforce.com/api/get_category_posts/?page="+n+"&slug="+t}):void 0},o.getCategories=function(){return e({method:"GET",url:"http://kidzforce.com/api/get_category_index/"})},o.getTags=function(){return e({method:"GET",url:"http://kidzforce.com/api/get_tag_index/"})},o}]),appControllers.factory("globalFactory",function(){return{getPostImageFeed:function(e){var o=document.createElement("div");o.innerHTML=e;var t=o.getElementsByTagName("img"),n=o.getElementsByTagName("iframe");if(t.length>=1)return imgthumb=t[0].src,imgthumb;if(n.length>=1){iframeVideo=n[0].src;var r=/(\?v=|\/\d\/|\/embed\/)([a-zA-Z0-9\-\_]+)/;if(videokeynum=iframeVideo.match(r),videokeynum)return videokey=iframeVideo.match(r)[2],imageurl="http://i2.ytimg.com/vi/"+videokey+"/0.jpg",imageurl}}}}),appControllers.controller("signupIdentityModalCtrl",["$scope","$state","$rootScope","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","$timeout","$ionicSlideBoxDelegate","ParentService","$ionicModal","WizardHandler",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f){e.currentIndex=0,e.params={addressObject:{address:"",address_2:"",city:"",state:"",zip:""},phone:"",ssn:"",tos:""},e._calculateAge=function(e){var o=Date.now()-e.getTime(),t=new Date(o);return Math.abs(t.getUTCFullYear()-1970)},e.firstStepCompleted=function(){return""==e.params.address||""==e.params.phone},e.secondStepCompleted=function(){return""==e.params.first_name||""==e.params.last_name||""==e.params.email||""==e.params.password||""==e.params.phone},e.next=function(o){window.cordova&&cordova.plugins.Keyboard.close(),t.showLoader();e.currentIndex=1,s.hide()},e.prev=function(o){e.currentIndex=o},e.submit=function(){window.cordova&&cordova.plugins.Keyboard.close(),t.showLoader(),m.verifyIdentity(e.params.addressObject,e.params.phone,e.params.ssn).then(function(e){s.hide(),t.verifyIdentityModal.hide(),t.verifyIdentityToAddProject&&h.fromTemplateUrl("templates/addproject.html",{scope:t,animation:"slide-in-up"}).then(function(e){t.projectId=0,t.modal=e,t.modal.show()})},function(e){s.hide(),t.showPopup("Unable to verify","Your identity could not be verified. Please contact KidzForce if you believe this is an error.")})},e.countryCode="US",e.onAddressSelection=function(o){e.params.addressObject.address=o.name;for(var t=0;t<o.address_components.length;t++){var n=o.address_components[t];"locality"==n.types[0]&&(e.params.addressObject.city=n.long_name),"administrative_area_level_1"==n.types[0]&&(e.params.addressObject.state=n.short_name),"postal_code"==n.types[0]&&(e.params.addressObject.zip=n.short_name)}},e.formValidSubmit=function(e,o){e.$valid&&(1==o?f.wizard().goTo("social"):f.wizard().finish())}}]),appControllers.controller("loginCtrl",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","$firebaseAuth","$cordovaOauth","ParentService",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h){setTimeout(function(){window.cordova&&cordova.plugins.instabug.activate({android:"015fdf7e4ddec6ced811fb55513b1f80",ios:"f2b8b9c8e44042d6fd170772291a7e7a"},"shake",{commentRequired:!0,colorTheme:"dark",shakingThresholdAndroid:"0.1",shakingThresholdIPhone:"1.5",shakingThresholdIPad:"0.6",enableIntroDialog:!1},function(){console.log("Instabug initialized.")},function(e){console.log("Instabug could not be initialized - "+e)})},500),s.first_run=!1,e.login={username:"",password:""},e.isAnimated=n.isAnimated,e.data={},e.data.isMale=!0,e.num_of_failures=0,e.attemptLogin=function(n){n.$valid&&(window.cordova&&cordova.plugins.Keyboard.close(),e.showLoader(),d.login(e.login.username,e.login.password).then(function(n){"child"==n?(l.hide(),t.go("app.child-dashboard")):h.getProfile().then(function(e){s.parent=e.data,l.hide(),window.isBrowserMode?(o.loggedIn=!0,location.href="http://kidzforce.com/dashboard/"):t.go("app.parent-dashboard")},function(o){console.error(o),l.hide(),e.num_of_failures+=1,3==e.num_of_failures?e.showForgotPassword():e.showPopup("Invalid login","Your login was not valid. Please check your login information and try again.","error")})},function(t){return l.hide(),console.error(t),"auth/user-not-found"==t.code?void o.showSignupModal(e.login.username,e.login.password):(e.num_of_failures+=1,void(3==e.num_of_failures?e.showForgotPassword():e.showPopup("Invalid login","Your login was not valid. Please check your login information and try again.","error")))}))},e.authObj=u(),e.attemptFacebookLogin=function(){e.showLoader(),d.loginWithFacebook().then(function(n){l.hide(),h.getProfile().then(function(e){s.parent=e.data,window.isBrowserMode?(o.loggedIn=!0,location.href="http://kidzforce.com/dashboard/"):t.go("app.parent-dashboard")},function(o){console.error(o),l.hide(),e.showPopup("Invalid login","Your login was not valid. Please check your login information and try again.","error")})},function(o){l.hide(),console.error(o),e.showPopup("Invalid login","Your login was not valid. Please check your login information and try again.","error")})},e.attemptGoogleLogin=function(){e.showLoader(),d.loginWithGoogle().then(function(n){l.hide(),h.getProfile().then(function(e){s.parent=e.data,window.isBrowserMode?(o.loggedIn=!0,location.href="http://kidzforce.com/dashboard/"):t.go("app.parent-dashboard")},function(t){d.reset(),l.hide(),0==t.success&&o.showSignupModal(e.login.username,e.login.password)})},function(o){l.hide(),console.error(o),e.showPopup("Invalid login","Your login was not valid. Please check your login information and try again.","error")})},e.showForgotPassword=function(){if(e.num_of_failures=0,""!=e.login.username||void 0!=typeof e.login.username){var t=r.confirm({title:"Reset password",template:'Do you want to reset your password for "'+e.login.username+'"?'});t.then(function(t){t&&(o.showLoader(),d.resetPassword(e.login.username).then(function(t){l.hide(),o.showPopup("Password Reset","Check your email for instructions to change your password."),e.login.username="",e.login.password=""},function(e){l.hide(),o.showPopup("Could not reset password","This could be because this user does not exist, or an internal error occurred.")}))})}},e.$on("$ionicParentView.beforeEnter",function(){window.isBrowserMode||("undefined"!=typeof s.uid&&(s.uid.indexOf("-")==-1?t.go("app.parent-dashboard"):t.go("app.child-dashboard")),"undefined"!=typeof s.username&&"undefined"!=typeof s.password&&t.go("app.child-dashboard"))})}]),appControllers.controller("signupModalCtrl",["$scope","$state","$stateParams","$rootScope","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","$timeout","$ionicSlideBoxDelegate","WizardHandler","$ionicScrollDelegate",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f){e.currentIndex=0,console.log(n.params),e.params={uid:"",month:"",day:"",year:"",dob:"",gender:1,first_name:"",last_name:"",email:n.params.email,password:n.params.password,phone:"",registerAsChild:!1,addressObject:{address:"",address_2:"",city:"",state:"",zip:""}},e.inprogress=!1,e._calculateAge=function(e){var o=Date.now()-e.getTime(),t=new Date(o),n=Math.abs(t.getUTCFullYear()-1970);return n},e.firstStepCompleted=function(){return""==e.params.dob},e.secondStepCompleted=function(){return""==e.params.first_name||""==e.params.last_name||""==e.params.email||""==e.params.password||""==e.params.phone},e.formValidSubmit=function(o,t){return n.showLoader(),e.inprogress=!0,setTimeout(function(){window.cordova&&cordova.plugins.Keyboard.close(),ionic.DomUtil.blurAll()},200),o.$valid?void e.next(t):void n.showPopup("Validation Error","Check the fields above and try again.","error")},e.next=function(o){console.log(o),f.scrollTop(),window.cordova&&cordova.plugins.Keyboard.close(),ionic.DomUtil.blurAll(),n.showLoader();var t=[];if(1==o){var r=new Date(e.params.dob);if(t=t.concat({key:"dob",value:r}),window.isBrowserMode?(t=t.concat({key:"month",value:e.params.month.id}),t=t.concat({key:"day",value:e.params.day}),t=t.concat({key:"year",value:e.params.year})):(t=t.concat({key:"month",value:new Date(e.params.dob).getMonth()+1}),t=t.concat({key:"day",value:new Date(e.params.dob).getDate()}),t=t.concat({key:"year",value:new Date(e.params.dob).getFullYear()}),console.log(t)),t=t.concat({key:"gender",value:e.params.gender}),t=t.concat({key:"first_name",value:e.params.first_name}),t=t.concat({key:"last_name",value:e.params.last_name}),t=t.concat({key:"email",value:e.params.email}),t=t.concat({key:"password",value:e.params.password}),e._calculateAge(r)<=12)return l.hide(),e.inprogress=!1,void n.showPopup("You are too young","You are under 13. Your parent must create an account for you.","error");e._calculateAge(r)>=13&&e._calculateAge(r)<=17?(e.params.registerAsChild=!0,console.log("registering as child")):(e.params.registerAsChild=!1,console.log("not registering as child"))}else(2==o&&e.params.registerAsChild||3==o)&&(window.isBrowserMode?(t=t.concat({key:"month",value:e.params.month.id}),t=t.concat({key:"day",value:e.params.day}),t=t.concat({key:"year",value:e.params.year})):(t=t.concat({key:"month",value:new Date(e.params.dob).getMonth()+1}),t=t.concat({key:"day",value:new Date(e.params.dob).getDate()}),t=t.concat({key:"year",value:new Date(e.params.dob).getFullYear()}),console.log(t)),t=t.concat({key:"dob",value:e.params.dob}),t=t.concat({key:"gender",value:e.params.gender}),t=t.concat({key:"first_name",value:e.params.first_name}),t=t.concat({key:"last_name",value:e.params.last_name}),t=t.concat({key:"email",value:e.params.email}),t=t.concat({key:"password",value:e.params.password}),e.isTeen()&&(t=t.concat({key:"address_1",value:e.params.addressObject.address}),t=t.concat({key:"address_2",value:e.params.addressObject.address_2}),t=t.concat({key:"city",value:e.params.addressObject.city}),t=t.concat({key:"state",value:e.params.addressObject.state}),t=t.concat({key:"zip",value:e.params.addressObject.zip})));3!=o?(1==o&&d.checkIfEmailExists(e.params.email).then(function(o){console.log("response: "+o),d.existsInFirebase(e.params.email).then(function(o){n.showPopup("Continue registering","You did not complete your previous registration please login and try again.","error").then(function(){for(var t=0;t<o.length;t++){var n=o[t];"google.com"==n?e.$apply(function(){e.attemptGoogleLogin()}):"facebook.com"==n&&e.$apply(function(){e.attemptFacebookLogin()})}})},function(e){e&&n.showPopup("Email already exists","That email is already in use. Reset your password or use a different email address and try again.","error")})},function(e){n.showPopup("Email already exists","That email is already in use. Reset your password or use a different email address and try again.","error")}),console.log(t),d.validateSignup(o,t).then(function(n){console.log(n),1!=o||t.registerAsChild?(l.hide(),e.currentIndex=o,e.inprogress=!1):(console.log("signing up user."),e.isTeen()?(l.hide(),h.wizard().goTo("isTeen"),e.inprogress=!1):e.registerWithService(t,o))},function(o){"undefined"!=typeof o.success?("undefined"==o.success&&n.showPopup("Validation Error","You have an error in your fields and try again"),e.inprogress=!1):"The email has already been taken."==o.message.email[0]?n.showPopup("Email already exists","That email is already in use. Reset your password or use a different email address and try again.","error"):n.showPopup("Validation Error","You have an error in your fields and try again"),l.hide(),e.inprogress=!1})):(window.isBrowserMode?(t=t.concat({key:"month",value:e.params.month.id}),t=t.concat({key:"day",value:e.params.day}),t=t.concat({key:"year",value:e.params.year})):(t=t.concat({key:"month",value:new Date(e.params.dob).getMonth()+1}),t=t.concat({key:"day",value:new Date(e.params.dob).getDate()}),t=t.concat({key:"year",value:new Date(e.params.dob).getFullYear()}),console.log(t)),t=t.concat({key:"dob",value:e.params.dob}),t=t.concat({key:"gender",value:e.params.gender}),t=t.concat({key:"first_name",value:e.params.first_name}),t=t.concat({key:"last_name",value:e.params.last_name}),t=t.concat({key:"email",value:e.params.email}),t=t.concat({key:"password",value:e.params.password}),e.isTeen()&&(t=t.concat({key:"address_1",value:e.params.addressObject.address}),t=t.concat({key:"address_2",value:e.params.addressObject.address_2}),t=t.concat({key:"city",value:e.params.addressObject.city}),t=t.concat({key:"state",value:e.params.addressObject.state}),t=t.concat({key:"zip",value:e.params.addressObject.zip})),e.isTeen()&&e.registerWithService(t,o))},e.registerWithService=function(o,t){if(""==e.params.uid)d.signupWithEmail(e.params.email,e.params.password).then(function(n){o=o.concat({key:"uid",value:firebase.auth().currentUser.uid}),firebase.auth().currentUser.getToken(!0).then(function(n){d.notifyOfNewAccount(n,o).then(function(o){console.log(o),l.hide(),e.currentIndex=t,h.wizard().goTo("finished"),e.inprogress=!1},function(o){l.hide(),console.error(o),e.inprogress=!1})}).catch(function(o){l.hide(),console.error(o),e.inprogress=!1})},function(o){l.hide(),console.error(o),e.inprogress=!1});else{var n=firebase.auth.EmailAuthProvider.credential(e.params.email,e.params.password);firebase.auth().currentUser.link(n).then(function(n){firebase.auth().currentUser.getToken(!0).then(function(n){d.notifyOfNewAccount(n,o).then(function(o){console.log(o),l.hide(),e.currentIndex=t,h.wizard().goTo("finished")},function(e){l.hide(),console.error(e)})}).catch(function(e){l.hide(),console.error(e)})}).catch(function(e){l.hide(),console.error(e)})}},e.prev=function(o){e.currentIndex=o},e.attemptFacebookLogin=function(){e.showLoader(),d.loginWithFacebook().then(function(t){d.checkIfEmailExists(firebase.auth().currentUser.email).then(function(){l.hide(),e.params.uid=s.uid,e.params.email=firebase.auth().currentUser.email,e.params.first_name=firebase.auth().currentUser.displayName.split(" ")[0],e.params.last_name=firebase.auth().currentUser.displayName.split(" ")[1],e.params.day="22",e.params.month={id:1,name:"January"},e.params.year="1980",e.params.dob=new Date("1/1/1980"),e.next(1)},function(){l.hide(),window.isBrowserMode?(n.loggedIn=!0,n.horizontalSections(),angular.element($('[ng-controller="webCtrl"]')).scope().loadInit(),n.modal.hide(),setTimeout(function(){n.horizontalSections()},500)):(console.log("parent"),o.go("app.parent-dashboard")),n.modal.hide()})},function(o){l.hide(),console.error(o),e.showPopup("Invalid Login","Your login was not valid. Please check your login information and try again.","error")})},e.attemptGoogleLogin=function(){e.showLoader(),d.loginWithGoogle().then(function(t){d.checkIfEmailExists(firebase.auth().currentUser.email).then(function(){l.hide(),e.params.uid=s.uid,e.params.email=firebase.auth().currentUser.email,e.params.first_name=firebase.auth().currentUser.displayName.split(" ")[0],e.params.last_name=firebase.auth().currentUser.displayName.split(" ")[1],e.params.day="22",e.params.month={id:1,name:"January"
},e.params.year="1980",e.params.dob=new Date("1/1/1980"),e.next(1)},function(){l.hide(),window.isBrowserMode?(n.loggedIn=!0,n.horizontalSections(),angular.element($('[ng-controller="webCtrl"]')).scope().loadInit(),n.modal.hide(),setTimeout(function(){n.horizontalSections()},500)):(console.log("parent"),o.go("app.parent-dashboard")),n.modal.hide()})},function(o){l.hide(),console.error(o),e.showPopup("Invalid Login","Your login was not valid. Please check your login information and try again.","error")}),cordova.plugins.Keyboard.close()},e.active="item1",e.setActive=function(o){e.active=o,"item1"==o?e.params.gender=1:e.params.gender=2},e.isActive=function(o){return o==e.active?"button-assertive":""},e.fieldValues={dateOfBirth:""},e.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],e.months=[{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}],e.years=[];for(var g=new Date,w=g.getFullYear();w>g.getFullYear()-100;w--)e.years.push(w);e.updateDate=function(o){console.log(o),"year"==o?(e.params.month="",e.params.day=""):"month"==o&&(e.params.day=""),console.log(e.params.year),console.log(e.params.month),console.log(e.params.day),e.params.year&&e.params.month&&e.params.day&&(e.params.dob=new Date(e.params.year,e.params.month.id-1,e.params.day),console.log(e.params.dob))},e.isEmpty=function(o){return"year"==o&&""==e.params.year?"Year":"month"==o&&""==e.params.month?"Month":"day"==o&&""==e.params.day?"Day":""},e.setInput=function(o,t){"year"==o&&(e.params.year=t),"month"==o&&(e.params.month=t),"day"==o&&(e.params.day=t),e.params.year&&e.params.month&&e.params.day&&(e.params.dob=new Date(e.params.year,e.params.month.id-1,e.params.day),console.log(e.params.dob))},e.isTeen=function(){return!!e.params.registerAsChild},e.onAddressSelection=function(o){e.params.addressObject.address=o.name;for(var t=0;t<o.address_components.length;t++){var n=o.address_components[t];"locality"==n.types[0]&&(e.params.addressObject.city=n.long_name),"administrative_area_level_1"==n.types[0]&&(e.params.addressObject.state=n.short_name),"postal_code"==n.types[0]&&(e.params.addressObject.zip=n.short_name)}},e.teenStepCompleted=function(){return""==e.params.addressObject.address||""==e.params.addressObject.city||""==e.params.addressObject.state||""==e.params.addressObject.zip}}]),angular.module("kb").factory("AuthService",["$http","$q","$localStorage","ENDPOINT_LIST","$firebaseAuth","$cordovaOauth",function(e,o,t,n,r,i){var a={},c=r();return a.reset=function(){var e=o.defer();return firebase.auth().signOut().then(function(){window.cordova&&window.plugins.googleplus.logout(function(e){}),t.$reset({first_run:!1}),console.log("logged out of firebase."),e.resolve("logged out")}),e.promise},a.registerForNotifications=function(){var e=o.defer();if(window.cordova){var t=PushNotification.init({android:{senderID:"12345679"},browser:{pushServiceURL:"http://push.api.phonegap.com/v1/push"},ios:{alert:"true",badge:"true",sound:"true"},windows:{}});t.on("registration",function(o){console.log(o);var t=o.registrationId;e.resolve(t)}),t.on("notification",function(e){console.log(e),e.additionalData.foreground?console.log("foreground"):console.log("background")}),t.on("error",function(o){console.error(o.message),e.reject(o.message)})}else e.reject("");return e.promise},a.login=function(r,i){a.reset();var s=o.defer(),l=function(a){var s=o.defer(),l=n.CHILD_CHECK_API,d="username="+encodeURIComponent(r)+"&password="+encodeURIComponent(i)+"&devicetoken="+encodeURIComponent(a),p={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.post(l,d,p).success(function(e){e.success?(window.isBrowserMode&&s.reject(e),t.username=r,t.password=i,t.child=e.data,s.resolve("child")):(console.log(r),console.log(i),c.$signInWithEmailAndPassword(r,i).then(function(e){t.uid=e.uid,t.parent={},s.resolve("parent")}).catch(function(e){s.reject(e)}))}).error(function(e){console.log(r),console.log(i),c.$signInWithEmailAndPassword(r,i).then(function(e){t.uid=e.uid,t.parent={},s.resolve("parent")}).catch(function(e){console.log(e),s.reject(e)})}),s.promise};return this.registerForNotifications().then(function(e){l(e).then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(e){l("").then(function(e){s.resolve(e)},function(e){s.reject(e)})}),s.promise},a.checkIfEmailExists=function(t){var r=o.defer(),i="email="+encodeURIComponent(t),a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.post(n.REGISTER_EMAIL_VALIDATION_API,i,a).success(function(e){0==e.success?r.resolve("doesnt exist"):r.reject("exists")}).error(function(e){r.reject("exists or validation error")}),r.promise},a.existsInFirebase=function(e){var t=o.defer();return firebase.auth().fetchProvidersForEmail(e).then(function(e){if(0==e.length)t.reject(!1);else{for(var o=0;o<e.length;o++)"password"==e[o]&&t.reject(!0);t.resolve(e)}}).catch(function(){t.reject(!1)}),t.promise},a.loginWithFacebook=function(){a.reset();var e=o.defer(),r=function(e){var r=o.defer();if(window.isBrowserMode){var s=new firebase.auth.FacebookAuthProvider;s.addScope("user_birthday"),firebase.auth().signInWithPopup(s).then(function(e){var o=e.user;e.credential;a.loginOrRegister(o).then(function(o){t.uid=e.user.uid,t.parent={},r.resolve("parent")},function(e){console.error(e),r.reject(e)})}).catch(function(e){console.log("Error: "+e),r.reject(e)})}else i.facebook(n.FBAPPID,["email"]).then(function(e){console.log("result: ",e),window.f=e;var o=firebase.auth.FacebookAuthProvider.credential(e.access_token);c.$signInWithCredential(o).then(function(e){a.loginOrRegister(e).then(function(o){t.uid=e.uid,t.parent={},r.resolve("parent")},function(e){console.error(e),r.reject(e)})},function(e){console.error("ERROR: "+e),r.reject(e)})},function(e){console.log("ERROR: "+e),r.reject(e)});return r.promise};return this.registerForNotifications().then(function(o){r(o).then(function(o){e.resolve(o)},function(o){e.reject(o)})},function(o){r("").then(function(o){e.resolve(o)},function(o){e.reject(o)})}),e.promise},a.loginWithGoogle=function(){a.reset();var e=o.defer(),n=function(e){var n=o.defer();if(window.isBrowserMode){var r=new firebase.auth.GoogleAuthProvider;r.addScope("https://www.googleapis.com/auth/plus.login"),r.addScope("https://www.googleapis.com/auth/plus.me"),r.addScope("https://www.googleapis.com/auth/userinfo.email"),r.addScope("https://www.googleapis.com/auth/userinfo.profile"),r.addScope("https://www.googleapis.com/auth/user.birthday.read"),firebase.auth().signInWithPopup(r).then(function(e){var o=e.user;e.credential;console.log(e),a.loginOrRegister(o).then(function(o){t.uid=e.user.uid,t.parent={},n.resolve("parent")},function(e){console.error(e),n.reject(e)})}).catch(function(e){console.log("Error: "+e),n.reject(e)})}else window.plugins.googleplus.login({scopes:"",webClientId:"",offline:!0},function(e){window.g=e,result=JSON.stringify(e),console.log("result: ",result);var o=firebase.auth.GoogleAuthProvider.credential(e.idToken);c.$signInWithCredential(o).then(function(e){console.log(e),a.loginOrRegister(e).then(function(o){t.uid=e.uid,t.parent={},n.resolve("parent")},function(e){console.error(e),n.reject(e)})},function(e){console.error("ERROR: "+e),n.reject(e)})},function(e){n.reject(e)});return n.promise};return this.registerForNotifications().then(function(o){n(o).then(function(o){e.resolve(o)},function(o){e.reject(o)})},function(o){n("").then(function(o){e.resolve(o)},function(o){e.reject(o)})}),e.promise},a.loginOrRegister=function(e){var t=o.defer(),e=firebase.auth().currentUser;return a.checkIfEmailExists(e.email).then(function(o){firebase.auth().currentUser.getToken(!0).then(function(o){var n=[];n=n.concat({key:"month",value:1}),n=n.concat({key:"day",value:1}),n=n.concat({key:"year",value:1980}),n=n.concat({key:"dob",value:"1/1/1980"}),n=n.concat({key:"gender",value:1}),"undefined"==typeof e.displayName||null==e.displayName?(n=n.concat({key:"first_name",value:e.providerData[0].displayName.split(" ")[0]}),n=n.concat({key:"last_name",value:e.providerData[0].displayName.split(" ")[1]})):(n=n.concat({key:"first_name",value:e.displayName.split(" ")[0]}),n=n.concat({key:"last_name",value:e.displayName.split(" ")[1]})),n=n.concat({key:"email",value:e.email}),a.notifyOfNewAccount(o,n).then(function(e){console.log(e),t.resolve("registered")},function(e){console.error(e),t.reject(e)})}).catch(function(e){console.error(e),t.reject(e)})},function(e){t.resolve("registered")}),t.promise},a.forgotPassword=function(e){a.reset()},a.validateSignup=function(t,r){for(var i=o.defer(),a=n.SIGNUP_VALIDATION_API,c="step="+encodeURIComponent(t),s=0;s<r.length;s++){var l=r[s];c+="&"+encodeURIComponent(l.key)+"="+encodeURIComponent(l.value)}var d={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.post(a,c,d).success(function(e){e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},a.signupWithEmail=function(e,t){a.reset();var n=o.defer();return firebase.auth().createUserWithEmailAndPassword(e,t).then(function(e){n.resolve(e)}).catch(function(e){n.reject(e)}),n.promise},a.notifyOfNewAccount=function(t,r){var i=o.defer();console.log("idtoken: ",t),console.log("params: ",r);for(var a=n.REGISTER_SUBMIT_API,c="id_token="+encodeURIComponent(t),s=0;s<r.length;s++){var l=r[s];c+="&"+encodeURIComponent(l.key)+"="+encodeURIComponent(l.value)}var d={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.post(a,c,d).success(function(e){e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},a.resetPassword=function(e){var t=o.defer();return firebase.auth().sendPasswordResetEmail(e).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},a.logout=function(){a.reset()},a}]),angular.module("kb").factory("ChildService",["$http","$q","$localStorage","ENDPOINT_LIST","$firebaseObject","$firebaseArray",function(e,o,t,n,r,i){var a={};return a.updateResume=function(r,i){var a=o.defer(),c=n.CHILD_RESUME_UPDATE_API,s="member-id="+encodeURIComponent(r)+"&resume="+encodeURIComponent(i);s+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.post(c,s,l).success(function(e){e.success?a.resolve(e):a.reject(e)}).error(function(e){a.reject(e)}),a.promise},a.updatePassword=function(r,i,a){var c=o.defer(),s=n.CHILD_PASSWORD_UPDATE_API,l="member-id="+r+"&password="+encodeURIComponent(i)+"&confirm="+encodeURIComponent(a);l+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var d={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.post(s,l,d).success(function(e){console.log(e),e.success?c.resolve(e):c.reject(e)}).error(function(e){c.reject(e)}),c.promise},a.deleteAccount=function(r,i){var a=o.defer(),c=n.CHILD_DELETE_API,s="member-id="+r+"&password="+encodeURIComponent(i);s+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.post(c,s,l).success(function(e){e.success?a.resolve(e):a.reject(e)}).error(function(e){a.reject(e)}),a.promise},a.retriveLocalResults=function(r,i,a){null==a&&(a=50);var c=o.defer(),s=n.CHILD_LOCAL_RESULTS_API,l="lat="+encodeURIComponent(r)+"&lng="+encodeURIComponent(i);l+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var d={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.post(s,l,d).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},a.viewChore=function(r){var i=o.defer(),a=n.PROJECT_VIEW_API,c="chore_id="+encodeURIComponent(r);c+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var s={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.post(a,c,s).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},a.applyForChore=function(r){var i=o.defer(),a=n.PROJECT_APPLY_API,c="chore_id="+encodeURIComponent(r);c+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var s={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return console.log(c),e.post(a,c,s).success(function(e){console.log(e),e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},a.checkIn=function(r){console.log(r);var i=o.defer(),a=n.CHILD_PROJECT_CHECKIN_API,c="chore_id="+encodeURIComponent(r);c+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var s={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.post(a,c,s).success(function(e){console.log(e),e.success?i.resolve(e):i.reject(e)}).error(function(e){console.log(e),i.reject(e)}),i.promise},a.getRewards=function(){var n=o.defer(),r="rewards.json",i={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.get(r,i).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},a.requestDeposit=function(){var r=o.defer(),i=n.CHILD_REQUEST_DEPOSIT_API;i+="?&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return e.get(i,a).success(function(e){e.success?r.resolve(e):r.reject(e)}).error(function(e){console.error(e),r.reject(e)}),r.promise},a.getNotifications=function(t){var r=o.defer(),i=n.DOMAIN+"children/getnotifications?member-id="+encodeURIComponent(t)+"&readnotifications",a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.get(i,a).success(function(e){r.resolve(e)}).error(function(e){console.error(e),r.reject(e)}),r.promise},a.createChild=function(r){var i=o.defer(),a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}},c="gender="+encodeURIComponent(r.gender+1)+"&username="+encodeURIComponent(r.username)+"&name="+encodeURIComponent(r.name)+"&month="+encodeURIComponent(r.birthdate.getMonth()+1)+"&day="+encodeURIComponent(r.birthdate.getDate())+"&year="+encodeURIComponent(r.birthdate.getFullYear())+"&phone="+encodeURIComponent(r.phone)+"&pin="+encodeURIComponent(r.pin)+"&api_token="+encodeURIComponent(t.uid);return e.post(n.DOMAIN+"children/add",c,a).success(function(e){e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},a.getProfile=function(r){var i=o.defer(),a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}},c="childId="+encodeURIComponent(r)+"&api_token="+encodeURIComponent(t.uid);return e.post(n.DOMAIN+"children/get",c,a).success(function(e){e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},a.getProfileFromFB=function(e){var t=o.defer(),n=firebase.database().ref().child("children").child(e),i=r(n);return i.$loaded().then(function(){t.resolve(i)}),t.promise},a.getReviews=function(e){var t=o.defer(),n=firebase.database().ref().child("project_reviews").child(e),r=i(n);return r.$loaded().then(function(){t.resolve(r)}),t.promise},a.storeContacts=function(e,t){var n=o.defer(),r=firebase.database().ref().child("emergency_contacts").child(e),a=i(r);return a.$loaded().then(function(){a.$add(t).then(function(){}),a.$save().then(function(){n.resolve(!0)})}),n.promise},a.getEmergencyContacts=function(e){var t=o.defer(),n=firebase.database().ref().child("emergency_contacts").child(e),r=i(n);return r.$loaded().then(function(){t.resolve(r)}),t.promise},a.getProjectApplications=function(e){var t=o.defer(),n=firebase.database().ref().child("project_applications").child(e),r=i(n);return r.$loaded().then(function(){t.resolve(r)}),t.promise},a.getMyProjects=function(e){var t=o.defer(),n=firebase.database().ref().child("chores").orderByChild("child_uid").equalTo(e),r=i(n);return r.$loaded().then(function(){t.resolve(r)}),t.promise},a.toUTCDate=function(e){var o=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds());return o},a.dailyRooAvailable=function(e){var t=o.defer(),n=firebase.database().ref().child("daily_drops").child(e),i=r(n);return i.$loaded().then(function(){var e=new Date,o=a.toUTCDate(e),n=a.dateDiffInDays(new Date(i.$value),o);console.log(n),n>=1?t.resolve("available"):t.reject("unavailable")}),t.promise},a.dateDiffInDays=function(e,o){var t=864e5,n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),r=Date.UTC(o.getFullYear(),o.getMonth(),o.getDate());return Math.floor((r-n)/t)},a.awardDailyRoo=function(e,t){var n=o.defer(),i=firebase.database().ref().child("daily_drops").child(e),c=r(i);return c.$loaded().then(function(){var e=new Date,o=a.toUTCDate(e),t=o.getTime();c.$value=t,c.$save().then(function(){n.resolve("awarded")})}),n.promise},a.requestHelp=function(r,i){var a=o.defer(),c=n.REQUEST_HELP_API,s="phone_1="+r+"&phone_2="+i;s+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+encodeURIComponent(t.password);var l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return console.log(s),e.post(c,s,l).success(function(e){e.success?a.resolve(e):a.reject(e)}).error(function(e){a.reject(e)}),a.promise},a.requestReward=function(r){var i=o.defer(),a=n.REDEEM_POINTS_API,c="reward_id="+r,s={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.username,Authorized_Member_Pin:t.password}};return console.log(c),e.post(a,c,s).success(function(e){console.log(e),e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},a}]),angular.module("kb").factory("ChildrenService",["$http","$q","$localStorage","ENDPOINT_LIST","$firebaseArray","$firebaseObject",function(e,o,t,n,r,i){var a={};return a.getChildrenForParent=function(e){var t=o.defer(),n=firebase.database().ref("children").child(e),i=r(n);return i.$loaded().then(function(){t.resolve(i)}),t.promise},a.childExists=function(e){console.log(e);var t=e.split(""),e=t[0]+t[1]+t[2]+"-"+t[3]+t[4]+t[5]+"-"+t[6]+t[7]+t[8],n=o.defer(),r=firebase.database().ref("children").child(e),a=i(r);return a.$loaded().then(function(){console.log(a),null==a.$value&&a.id!=e?n.reject("doesnt exist"):n.resolve("exists")}),n.promise},a.childExistsByName=function(e){var t=o.defer(),n=firebase.database().ref("children").orderByChild("username").equalTo(e),r=i(n);return r.$loaded().then(function(){console.log(r)}),t.promise},a.getChildBalanceForParent=function(e){var t=o.defer(),n=firebase.database().ref("child_balances").child(e),r=i(n);return r.$loaded().then(function(){t.resolve(r)}),t.promise},a}]),angular.module("kb").factory("NotificationService",["$http","$q","$localStorage","ENDPOINT_LIST","$firebaseArray",function(e,o,t,n,r){var i={};i.respond=function(r,i){var a=o.defer(),c=n.CHILD_NOTIFICATION_RESPOND_API,s="notifiableid="+encodeURIComponent(r)+"&answer="+encodeURIComponent(i);s+="&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+t.password;var l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Authorized-Member-ID":t.username,"Authorized-Member-Pin":t.password}};return e.post(c,s,l).success(function(e){e.success?a.resolve(e):a.reject(e)}).error(function(e){a.reject(e)}),a.promise},i.notificationaction=function(r,i,a){var c,s=o.defer(),l=n.CHILD_NOTIFICATION_RESPOND_API;c=""!=a?"notifiable_id="+r+"&response_value="+i+"&response_additional_data="+a:"notifiable_id="+r+"&response_value="+i,c+="undefined"==typeof t.username||null==t.username?"&Authorized_Member_ID="+encodeURIComponent(t.uid)+"&api_token="+encodeURIComponent(t.uid):"&Authorized_Member_ID="+encodeURIComponent(t.username)+"&Authorized_Member_Pin="+t.password,console.log(c);var d={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Authorized-Member-ID":t.username,"Authorized-Member-Pin":t.password}};return e.post(l,c,d).success(function(e){console.log(e),e.success?s.resolve(e):s.reject(e)}).error(function(e){s.reject(e)}),s.promise};return i.reload=function(r,i,a){var c=o.defer();if(void 0!=i&&"undefined"!=typeof i||c.reject("Please provide a userId"),"undefined"!=typeof i){if(a)var s=n.PARENT_RELOAD_NOTIFICATIONS_API+"?Authorized_Member_ID="+i+"&page="+r;else var s=n.CHILD_RELOAD_NOTIFICATIONS_API+"?member-id="+i+"&readnotifications&page="+r;var l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}}}else var s=n.PARENT_RELOAD_NOTIFICATIONS_API+"?page="+r+"&Authorized_Member_ID="+t.uid,l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:"M82TBrvdHYSVBH6eDnkUmzkHSGx2"}};return e.get(s,l).success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},i.reloadProfile=function(){var r=o.defer(),i=n.CHILD_PROFILE_API,a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json","Authorized-Member-ID":t.username,"Authorized-Member-Pin":t.password}};return e.get(i,a).success(function(e){e.success?r.resolve(e):r.reject(e)}).error(function(e){r.reject(e)}),r.promise},i.getNotificationsFromFB=function(e){var t=o.defer(),n=firebase.database().ref().child("notifications").child(e),i=r(n);return i.$loaded().then(function(){t.resolve(i)}),t.promise},i}]),angular.module("kb").factory("ParentService",["$http","$q","$localStorage","ENDPOINT_LIST","$firebaseObject",function(e,o,t,n,r){var i={};return i.getProfile=function(){var r=o.defer(),i=n.PARENT_PROFILE_API;i+="?&api_token="+encodeURIComponent(t.uid);var a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.uid}};return e.get(i,a).success(function(e){e.success?r.resolve(e):r.reject(e)}).error(function(e){r.reject(e)}),r.promise},i.getChorePresets=function(){var r=o.defer(),i=n.CHORE_PRESET_API;i+="?&Authorized_Member_ID="+encodeURIComponent(t.uid);var a={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.get(i,a).success(function(e){e.success?r.resolve(e):r.reject(e)}).error(function(e){r.reject(e)}),r.promise},i.validateProject=function(r,i){for(var a=o.defer(),c=n.PROJECT_ADD_VALIDATION_API,s="step="+encodeURIComponent(r),l=0;l<i.length;l++){var d=i[l];s+="&"+encodeURIComponent(d.key)+"="+encodeURIComponent(d.value)}s+="&api_token="+encodeURIComponent(t.uid);var p={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}};return e.post(c,s,p).success(function(e){e.success?a.resolve(e):a.reject(e)}).error(function(e){a.reject(e)}),a.promise},i.retriveLocalResults=function(r,i,a){var c=o.defer(),s=n.PARENT_PROJECTS_API,l="?api_token="+encodeURIComponent(t.uid);l+="&Authorized_Member_ID="+encodeURIComponent(t.uid);var d={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.uid}};return e.get(s+l,d).success(function(e){c.resolve(e)}).error(function(e){console.error(e),c.reject(e)}),c.promise},i.getChildren=function(){var r=o.defer(),i=n.PARENT_CHILDREN_API,a="?api_token="+encodeURIComponent(t.uid);a+="&Authorized_Member_ID="+encodeURIComponent(t.uid);var c={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.uid}};return e.get(i+a,c).success(function(e){r.resolve(e)}).error(function(e){console.error(e),r.reject(e)}),r.promise},i.getIdentityStatus=function(){var e=o.defer(),n=firebase.database().ref().child("identities").child(t.uid),i=r(n);return i.$loaded().then(function(){"undefined"==typeof i.status?e.resolve({passed:"not checked"}):"passed"==i.status?e.resolve({passed:"passed"}):"failed"==i.status?e.resolve({passed:"failed"}):e.resolve({passed:"not checked"})}),e.promise},i.verifyIdentity=function(r,i,a){var c=o.defer(),s=n.PARENT_IDENTITY_VERIFY_API;s+="?&Authorized_Member_ID="+encodeURIComponent(t.uid);for(var l={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.uid}},d="",p=0;p<Object.keys(r).length;p++){var u=Object.keys(r)[p],m=r[u];d+="&"+encodeURIComponent(u)+"="+encodeURIComponent(m)}return d+="&phone="+encodeURIComponent(i)+"&ssn="+encodeURIComponent(a),console.log(s),console.log(d),e.post(s,d,l).success(function(e){console.log(e),e.success?c.resolve(e):c.reject(e)}).error(function(e){console.log(e),c.reject(e)}),c.promise},i.updateAccount=function(r){var i=o.defer(),a=n.PARENT_PROFILE_UPDATE_API;a+="?&Authorized_Member_ID="+encodeURIComponent(t.uid);var c={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorized_Member_ID:t.uid}},s="mobile_phone="+r.mobile_phone+"&address="+r.home_address;return e.post(a,s,c).success(function(e){e.success?i.resolve(e):i.reject(e)}).error(function(e){i.reject(e)}),i.promise},i.getIdentity=function(e){var t=o.defer(),n=firebase.database().ref().child("identities").child(e),i=r(n);return i.$loaded().then(function(){t.resolve(i)}),t.promise},i.getProfileFromFB=function(e){var t=o.defer(),n=firebase.database().ref().child("firebase_users").child(e),i=r(n);return i.$loaded().then(function(){t.resolve(i)}),t.promise},i}]),angular.module("kb").factory("ProductsService",["$http","$q","$localStorage","ENDPOINT_LIST","inAppPurchase",function(e,o,t,n,r){var i={};return i.loadProducts=function(){var e=o.defer();return e.promise},i.purchaseProduct=function(e){var t=o.defer();return r.getProducts([e]).then(function(e){console.log(e)}).catch(function(e){console.log(e)}),t.promise},i}]),angular.module("kb").factory("ProjectService",["$http","$q","$localStorage","ENDPOINT_LIST","$firebaseArray","$firebaseObject",function(e,o,t,n,r,i){var a={};return a.popularItems=function(){var r=o.defer(),i={headers:{"Content-Type":"application/json",Accept:"application/json"}};return e.get(n.DOMAIN+"projects/popularItems?api_token="+encodeURIComponent(t.uid),i).success(function(e){e.success?r.resolve(e.chores):r.reject(e)}).error(function(e){r.reject(e)}),r.promise},a.relatedItems=function(t){var n=o.defer(),r={headers:{"Ocp-Apim-Subscription-Key":"bf46b7d464d648418fa78fd118466d2b"}};return e.get("https://api.cognitive.microsoft.com/bing/v5.0/images/search?q="+t+"&count=6&offset=0&mkt=en-us&safeSearch=Strict",r).success(function(e){n.resolve(e.value)}).error(function(e){n.reject(e)}),n.promise},a.createProject=function(r){var i=o.defer(),c={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}},s="projectId="+encodeURIComponent(r.id)+"&title="+encodeURIComponent(r.title)+"&date="+encodeURIComponent(r.date)+"&projectType="+encodeURIComponent(r.type)+"&price="+encodeURIComponent(r.price)+"&description="+encodeURIComponent(r.description)+"&member-id="+encodeURIComponent(r.member_id)+"&photos_base64="+encodeURIComponent(r.photo)+"&timezone_offset="+encodeURIComponent(r.timezone_offset)+"&minimum_age="+encodeURIComponent(r.age_range)+"&api_token="+encodeURIComponent(t.uid);return e.post(n.DOMAIN+"projects/add",s,c).success(function(e){e.success?(a.cycleUserChores(t.uid).then(function(){console.log("Cycled projects")}),i.resolve(e)):i.reject(e)}).error(function(e){i.reject(response)}),i.promise},a.deleteProject=function(r){var i=o.defer(),c={headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}},s="projectId="+encodeURIComponent(r)+"&api_token="+encodeURIComponent(t.uid);return e.post(n.DOMAIN+"projects/delete",s,c).success(function(e){e.success?(a.cycleUserChores(t.uid).then(function(){console.log("Cycled projects")}),i.resolve(e)):i.reject(e)}).error(function(e){i.reject(response)}),i.promise},a.cycleUserChores=function(e){var t=o.defer();return a.getUserChores(e).then(function(e){for(var o=0;o<e.length;o++){var n=e[o],r=firebase.database().ref().child("chore-locations"),i=new GeoFire(r);i.set(n.id.toString(),[n.lat,n.lng]).then(function(){console.log("Provided key has been added to GeoFire")},function(e){console.log("Error: "+e)})}t.resolve("Cycled")}),t.promise},a.getChoreById=function(e){var t=o.defer(),n=firebase.database().ref().child("chores").child(e),r=i(n);return r.$loaded().then(function(){t.resolve(r)}),t.promise},a.getUserChores=function(e){var t=o.defer(),n=firebase.database().ref().child("user_chores").child(e),i=r(n);return i.$loaded().then(function(){t.resolve(i)}),t.promise},a}]),window.isBrowserMode=!1,angular.module("kb.constant",[]).constant("ENDPOINT_LIST",function(){var e="http://ec2-107-21-160-8.compute-1.amazonaws.com/app/api/",o="";return{DOMAIN:e+o,VERSION:"1.0.0",BUILD:"1.3.0",FBAPPID:"1159778540770974",DOMAIN:e,CHILD_CHECK_API:e+o+"children/authas",CHILD_NOTIFICATION_RESPOND_API:e+o+"children/notification/respond",CHILD_PROFILE_API:e+o+"children/profile",PARENT_PROFILE_API:e+o+"parent/profile",CHILD_RESUME_UPDATE_API:e+o+"children/profile/resume",CHILD_PASSWORD_UPDATE_API:e+o+"children/profile/password",CHILD_DELETE_API:e+o+"children/profile/delete",CHILD_LOCAL_RESULTS_API:e+o+"children/projects/nearme",CHILD_RELOAD_NOTIFICATIONS_API:e+o+"children/notifications",PARENT_RELOAD_NOTIFICATIONS_API:e+o+"parent/notifications",PROJECT_VIEW_API:e+o+"projects/view",PROJECT_APPLY_API:e+o+"projects/apply",PROJECT_DELETE_API:e+o+"projects/delete",CHILD_REQUEST_DEPOSIT_API:e+o+"children/profile/deposit",SIGNUP_VALIDATION_API:e+o+"register/validate",REGISTER_SUBMIT_API:e+o+"register/add/submit",CHORE_PRESET_API:e+o+"projects/popularItems",PROJECT_ADD_VALIDATION_API:e+o+"projects/add/validate",PARENT_IDENTITY_STATUS_API:e+o+"parent/verified",CHILD_PROJECT_CHECKIN_API:e+o+"projects/checkin",PARENT_PROJECTS_API:e+o+"projects/list",PARENT_CHILDREN_API:e+o+"parent/children",PARENT_PROFILE_UPDATE_API:e+o+"profile/update",PARENT_IDENTITY_VERIFY_API:e+o+"parent/verify",REGISTER_EMAIL_VALIDATION_API:e+o+"register/userexists",REQUEST_HELP_API:e+o+"child/request_help",REDEEM_POINTS_API:e+o+"child/redeem_points"}}()),appControllers.directive("numbersOnly",function(){return{require:"ngModel",link:function(e,o,t,n){function r(e){if(e){var o=e.replace(/[^0-9]/g,"");return o!==e&&(n.$setViewValue(o),n.$render()),o}}n.$parsers.push(r)}}}),appControllers.filter("epochToDate",function(e){return function(e){return new Date(Date(e))}}),appControllers.filter("numberSuffix",function(){return function(e){var o,t=["k","M","G","T","P","E"];return window.isNaN(e)?0:e<1e3?e:(o=Math.floor(Math.log(e)/Math.log(1e3)),(e/Math.pow(1e3,o)).toFixed(1)+t[o-1])}}),appControllers.filter("validMonths",function(){return function(e,o){var t=[],n=new Date,r=n.getUTCMonth()+1,i=n.getUTCFullYear()-18;
return""!=o&&(o==i?angular.forEach(e,function(e){e.id<=r&&t.push(e)}):angular.forEach(e,function(e){t.push(e)})),t}}),appControllers.filter("daysInMonth",function(){return function(e,o,t){var n=[];return angular.forEach(e,function(e){""!=t&&"undefined"!=typeof t&&(1==t.id||3==t.id||5==t.id||7==t.id||8==t.id||10==t.id||12==t.id?n.push(e):(4==t.id||6==t.id||9==t.id||11==t.id)&&e<=30?n.push(e):2==t.id&&(o%4==0&&e<=29?n.push(e):e<=28&&n.push(e)))}),n}}),appControllers.filter("validDays",function(){return function(e,o,t){var n=[],r=new Date,i=r.getUTCDate(),a=r.getUTCMonth()+1,c=r.getUTCFullYear()-18;return o==c&&t.id==a?angular.forEach(e,function(e){e<=i&&n.push(e)}):angular.forEach(e,function(e){n.push(e)}),n}}),appControllers.controller("addChildCtrl",function(e,o,t,n,r,i,a){e.child={id:0,gender:0,name:"",email:"",username:"",phone:"",pin:"",birthdate:""},e.isActive=function(o){return"boy"==o&&0==e.child.gender||"girl"==o&&1==e.child.gender},e.isActiveClass=function(o){return"boy"==o&&0==e.child.gender?"button-assertive":"girl"==o&&1==e.child.gender?"button-assertive":"button-positive"},e.setActive=function(o){"boy"==o?e.child.gender=0:e.child.gender=1},e.pickDate=function(){var o={callback:function(o){e.child.birthdate=new Date(o)},from:new Date(1999,1,1),to:new Date,mondayFirst:!0,showTodayButton:!1,closeOnSelect:!0};i.openDatePicker(o)},e.getDateTest=function(){t.getDateFromCalendarModal(e,!0,new Date(2009,1,1),new Date(1999,1,1),new Date(2010,1,1),function(o){e.child.birthdate=o,window.d=o})},e.addChild=function(){window.cordova&&cordova.plugins.Keyboard.close(),t.showLoader(),e.child.username=e.child.username.toLowerCase(),n.createChild(e.child).then(function(e){a.hide(),t.showPopup("Child Created","Your child has been created.","").then(function(){t.modal.hide()})},function(e){a.hide(),t.showPopup("Username taken","That username appears to be taken, please enter another and try again.","error").then(function(){})})},setTimeout(function(){var e=document.getElementById("fs-form-wrap");[].slice.call(document.querySelectorAll("select.cs-select")).forEach(function(e){new SelectFx(e,{stickyPlaceholder:!1,onChange:function(e){document.querySelector("span.cs-placeholder").style.backgroundColor=e}})}),new FForm(e,{onReview:function(){classie.add(document.body,"overview")}})},500)}),appControllers.controller("addProjectCtrl",["$scope","$state","$rootScope","ProjectService","ChildrenService","ionicDatePicker","ionicTimePicker","$ionicLoading","WizardHandler",function(e,o,t,n,r,i,a,c,s){e.project={id:0,type:0,member_id:"",title:"",photo:"",date:"",time:"",timezone_offset:(new Date).getTimezoneOffset()/60,price:10,description:"",age_min:10,age_max:13,age_range:9},e.validate=function(o){return 1==o?""!=e.project.title&&(1!=e.project.type||""!=e.project.member_id):2==o||(3==o?""!=e.project.date&&""!=e.project.time:4==o||void 0)},e.hasPhoto=function(){return""!=e.project.photo},e.isActive=function(o){return"public"==o&&0==e.project.type||"invite"==o&&1==e.project.type},e.isActiveClass=function(o){return"public"==o&&0==e.project.type?"button-assertive":"invite"==o&&1==e.project.type?"button-assertive":"button-positive"},e.setActive=function(o){"public"==o?e.project.type=0:e.project.type=1},e.popularItems=[],e.getPopularItems=function(){n.popularItems().then(function(o){e.popularItems=o},function(e){console.error(e)})},e.getPopularItems(),e.relatedItems=[],e.getRelatedItems=function(){n.relatedItems(e.project.title).then(function(o){e.relatedItems=o},function(e){alert(e),console.error(e)})},e.photoChanged=function(o){var t=new FileReader;t.addEventListener("load",function(){var o=t.result;e.$apply(function(){e.pickPhoto(o)})},!1),o[0]&&t.readAsDataURL(o[0])},e.pickPhoto=function(o){"undefined"!=typeof o?e.project.photo=o:window.isBrowserMode||!window.cordova?$("#project_photo").click():window.imagePicker.getPictures(function(o){for(var t=0;t<o.length;t++)e.$apply(function(){e.project.photo=o[t]})},function(e){},{maximumImagesCount:1,width:800})},e.selectPhoto=function(o){e.project.photo=o},e.clearPhoto=function(){e.project.photo=""},e.tmp={file:""},e.fileUploaded=function(e){},e.pickTime=function(){var o={callback:function(o){if("undefined"==typeof o);else{var n=new Date(1e3*o);e.project.time=t.millisToUTCDate(n.getTime())}},format:12,step:1,setLabel:"Set"};a.openTimePicker(o)},e.addProject=function(){window.cordova&&cordova.plugins.Keyboard.close(),e.project.date=new Date(e.project.date.getFullYear(),e.project.date.getMonth(),e.project.date.getDate(),e.project.time.getHours(),e.project.time.getMinutes(),e.project.time.getSeconds(),e.project.time.getMilliseconds()).getTime()/1e3,t.showLoader(),n.createProject(e.project).then(function(o){if(c.hide(),0==e.project.id)var n="created";else var n="updated";t.showPopup("Project "+n,"Your project has been "+n+".","").then(function(){t.modal.hide()})},function(o){if(console.error(o),c.hide(),0==e.project.id)var n="create";else var n="update";t.showPopup("Unable to "+n+" project","This could be related to a system error, please try again later.","error").then(function(){})})},e.getDateTest=function(){t.getDateFromCalendarModal(e,!0,new Date,new Date,new Date((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDay()),function(o){e.project.date=o,e.date=o})},e.formValidSubmit=function(o,n){o.$valid&&(1==n?1==e.project.type&&""!=e.project.member_id?r.childExists(e.project.member_id).then(function(){e.getRelatedItems(),s.wizard().goTo("photo")},function(){t.showPopup("Invalid child","Enter a valid child id and try again.","error").then(function(){e.project.member_id=""})}):(e.getRelatedItems(),s.wizard().goTo("photo")):2==n?s.wizard().goTo("schedule"):3==n?s.wizard().goTo("payment"):s.wizard().finish())},e.scanCard=function(){"undefined"==typeof window.cordova||window.isBrowserMode||cordova.plugins.barcodeScanner.scan(function(o){console.log("result: "+JSON.stringify(o)),e.$apply(function(){e.project.member_id=o.text})},function(e){alert("Scanning failed: "+e)},{preferFrontCamera:!1,showFlipCameraButton:!1,showTorchButton:!0,torchOn:!0,prompt:"Place a barcode inside the scan area",resultDisplayDuration:500,formats:"QR_CODE",orientation:"portrait",disableAnimations:!1,disableSuccessBeep:!1})},e.loadExistingProject=function(){"undefined"!=typeof t.projectId&&0!=t.projectId?(e.project.id=t.projectId,n.getChoreById(e.project.id).then(function(o){0!=o.child_uid&&1==o.projectType&&(e.project.member_id=o.child_uid),e.project.type=o.projectType,e.project.title=o.name,e.project.description=o.description,e.project.photo=o.photos,e.project.price=o.pointValuation,e.project.age_range=o.age_range,e.project.date=new Date(1e3*o.start_date),e.project.time=new Date(1e3*o.start_date)})):e.project={id:0,type:0,member_id:"",title:"",photo:"",date:"",time:"",timezone_offset:(new Date).getTimezoneOffset()/60,price:10,description:"",age_min:10,age_max:13,age_range:9}},e.selectPreset=function(o){e.project.title=o.title,e.project.photo=o.image,e.project.price=o.price,e.project.age_range=o.minimum_age,s.wizard().goTo("schedule")},e.skipPhoto=function(){e.project.photo=""}}]),appControllers.controller("checkInCtrl",["$scope","$state","$rootScope","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","NotificationService","ChildService","$ionicLoading",function(e,o,t,n,r,i,a,c,s,l,d,p,u,s){e.profile=c.child,e.mapMaximized=!1,u.viewChore(t.checkIn.data.project_id).then(function(o){console.log(o),e.chore=o;var n=new google.maps.LatLng(o.home.lat,o.home.lng),r={center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:16,scrollwheel:!1,panControl:!1,zoomControl:!1,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,styles:t.mapStyle};setTimeout(function(){var t=new google.maps.Map(document.getElementById("checkInMap"),r);e.map=t,setTimeout(function(){var t=new google.maps.LatLng(o.home.lat,o.home.lng);new google.maps.Marker({position:t,icon:"img/icons/marker.svg",map:e.map,animation:google.maps.Animation.DROP})},200)},200)},function(e){console.error(e)}),e.checkIn=function(e){t.showLoader(),u.checkIn(e).then(function(e){s.hide(),t.hasCheckIn=!1,t.checkIn=null,t.showPopup("Project started","When finished, press complete on the project card.","").then(function(){t.modal.hide()})},function(e){s.hide(),t.showPopup("Unable to check-in","This could be related to a system error, please try again later.","error")})}}]),appControllers.controller("childrenCtrl",["$scope","$state","$rootScope","ParentService","ionicDatePicker","$ionicLoading","ChildrenService","$localStorage",function(e,o,t,n,r,i,a,c){e.isEmpty=!1,e.dataLoaded=!1,e.children=[],e.hasChildren=function(){return e.children.length>0},a.getChildrenForParent(c.uid).then(function(o){e.children=o,0==e.children.length&&(e.isEmpty=!0),e.dataLoaded=!0}),setInterval(function(){0==e.children.length?e.isEmpty=!0:e.isEmpty=!1},500)}]),appControllers.controller("choresCtrl",function(e,o,t,n,r,i){if(e.projects=[],e.myprojects=[],e.projectsLoaded="not loaded",e.activeFilter="new",setTimeout(function(){$("#nonotification").hide()},500),o.isParent()&&(e.activeFilter="my"),e.changeActiveFilter=function(o){o!=e.activeFilter&&(e.activeFilter=o)},e.isActiveFilter=function(o){if(o==e.activeFilter)return"active"},o.isParent()||"undefined"==typeof i.child.home||null==i.child.home?e.center={latitude:0,longitude:0}:(e.home=i.child.home,e.center={latitude:parseFloat(e.home[0]),longitude:parseFloat(e.home[1])}),e.map={center:e.center,zoom:14},e.options={scrollwheel:!1,panControl:!1,zoomControl:!1,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,styles:o.mapStyle},e.homeMarker={id:0,coords:e.center,options:{icon:"img/icons/home-marker.png"}},e.choreMarkers=[],o.isParent())r.getUserChores(i.uid).then(function(o){e.myprojects=o,0==e.myprojects.length?(e.projectsLoaded="empty",e.myprojects=[]):e.projectsLoaded="not-empty"});else{var a=firebase.database().ref().child("chore-locations"),c=new GeoFire(a);navigator.geolocation.getCurrentPosition(function(t){e.$apply(function(){e.map.center={latitude:t.coords.latitude,longitude:t.coords.longitude},0==e.center.latitude&&0==e.center.longitude&&(e.center.latitude=e.map.center.latitude,e.center.longitude=e.map.center.longitude,e.homeMarker={id:0,coords:e.center,options:{icon:"img/icons/home-marker.png"}}),e.geoQuery=c.query({center:[e.map.center.latitude,e.map.center.longitude],radius:322}),e.geoQuery.on("ready",function(){}),n.getProfileFromFB(i.child["member-id"]).then(function(t){n.getProjectApplications(i.child["member-id"]).then(function(n){e.applications=n,e.geoQuery.on("key_entered",function(n,i,a){console.log("Key entered for chore"),r.getChoreById(n.replace("chore-","")).then(function(r){(0==r.child_uid||r.child_uid==e.uid)&&r.minimum_age<=o.getAgeFromDob(t.dob)&&"inactive"!=r.status&&(e.projects=e.projects.concat(r),i[0]==parseFloat(e.map.center.latitude)||i[1]==parseFloat(e.map.center.longitude)||o.isParent()&&!window.isBrowserMode||(e.choreMarkers=e.choreMarkers.concat({id:n.replace("chore-",""),latitude:i[0],longitude:i[1],icon:"img/icons/marker.png"})))})})})}),n.getMyProjects(i.child["member-id"]).then(function(o){e.myprojects=o,0==e.myprojects.length?(e.projectsLoaded="empty",e.myprojects=[]):e.projectsLoaded="not-empty"}),e.geoQuery.on("key_exited",function(o,t,n){console.log("Key exited for chore"),e.$apply(function(){for(var t=0;t<e.projects.length;t++)e.projects[t].id==o.replace("chore-","")&&(e.projects=e.projects.slice(t,t));0==e.projects.length?(e.projectsLoaded="empty",e.projects=[]):e.projectsLoaded="not-empty"})})})}),e.$watch("map.center",function(o,t){o!==t&&geoQuery.updateCriteria({center:[e.map.center.latitude,e.map.center.longitude],radius:322})})}e.viewProject=function(e){console.log(e),o.showProjectViewModal(e)},e.hasMap=function(){if(!o.isParent())return"hasMap"}}),appControllers.controller("helpMeCtrl",["$scope","$state","$rootScope","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","NotificationService","ChildService","ParentService","$ionicScrollDelegate","$cordovaContacts",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f){e.first_contact=null,e.second_contact=null,e.getContactList=function(){navigator.contacts.pickContact(function(o){console.log("The following contact has been selected:"+JSON.stringify(o)),e.$apply(function(){null==e.first_contact?e.first_contact=o:e.second_contact=o,u.storeContacts(c.child["member-id"],o).then(function(e){console.log(e)})})},function(e){console.error("Error: "+e)})},u.getEmergencyContacts(c.child["member-id"]).then(function(o){e.contacts=o;for(var t=0;t<e.contacts.length;t++)null==e.first_contact?e.first_contact=e.contacts[t]:e.second_contact=e.contacts[t]}),e.sendEmergency=function(){u.requestHelp(e.first_contact.phoneNumbers[0].value,e.second_contact.phoneNumbers[0].value).then(function(){console.log("sent alert"),t.showPopup("Contacts Notified","We have notifed your emergency contacts.")})}}]),appControllers.controller("IntroCtrl",["$scope","$state","$ionicSlideBoxDelegate",function(e,o,t){e.slideIndex=0,e.slideChanged=function(o){console.log("slideChanged: "+o),e.slideIndex=o},e.previous=function(){t.previous()},e.next=function(){t.next()},window.getParameterByName=function(e,o){o||(o=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=t.exec(o);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},window.handleOpenURL=function(e){setTimeout(function(){var t=window.getParameterByName("code",e),n=window.getParameterByName("email",e);""!=t&&null!=t&&""!=n&&null!=n&&($localStorage.guest_email=n,$localStorage.gueest_code=t,o.go("login-invited-guest"))},0)}}]),appControllers.controller("notificationCtrl",["$scope","$rootScope","$sce","$state","$ionicPopup","$ionicHistory","$ionicGesture","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","NotificationService","$q","$interval","$cordovaBadge","ProjectService","ChildService","ParentService","ChildrenService","WordPress",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f,g,w,v,y,b,_){o.isParent()||o.rooDailyDrops(l.child["member-id"]),e.isEmpty=!1,e.setBadge=function(e){window.isBrowserMode||g.hasPermission().then(function(o){g.set(e)},function(e){})},e.clearBadge=function(){window.isBrowserMode||g.clear().then(function(){},function(e){})},e.notifications=[],e.respond=function(o,t){e.declineDialog().then(function(e){m.respond(o,t).then(function(e){d.hide()},function(e){d.hide()})},function(e){})},e.additionalAction=function(e){"App\\Notifications\\newNotifications\\Homeowner\\ApplicantOfferNotification"==e.type&&o.viewChildProfile(e.data.child_id)},e.onClickNotification=function(t,n,r,i){"dismiss"==n?(d.show(),e.notifications[t].animate="zoomOut",m.notificationaction(r,n,i).then(function(e){d.hide()},function(e){d.hide()})):"check-in"==n?o.showCheckInModal(e.notifications[t]):"help"==n?o.showReportModal("Project Ref: #"+e.notifications[t].data.project_id,"Need help with this project."):(e.notifications[t].animate="zoomOut",d.show(),m.notificationaction(r,n,i).then(function(e){d.hide()},function(e){d.hide()}))},e.actionOrInfoCard=function(e){return"App\\Notifications\\newNotifications\\Child\\RequestedRatingNotification"==e||"App\\Notifications\\newNotifications\\Homeowner\\ApplicantOfferNotification"==e||"App\\Notifications\\newNotifications\\Child\\ReceivedRequestForApplicationNotification"==e||"App\\Notifications\\newNotifications\\Project\\CheckedInNotification"==e||"App\\Notifications\\newNotifications\\Child\\CheckInNotification"==e||"App\\Notifications\\newNotifications\\Parent\\RequestForApplicationNotification"==e},e.hasRating=function(e){return"App\\Notifications\\newNotifications\\Child\\RequestedRatingNotification"==e||"App\\Notifications\\newNotifications\\Child\\ReceivedRatingNotification"==e},e.hasMap=function(e){return!1},e.generateActions=function(e,t){var n=[];switch(e){case"App\\Notifications\\newNotifications\\Child\\RequestedRatingNotification":n=[{name:"SUBMIT",icon:"ion-checkmark-round",action:"submit-review"},{name:"HELP",icon:"ion-alert-circled",action:"help"}];break;case"App\\Notifications\\newNotifications\\Homeowner\\ApplicantOfferNotification":n=[{name:"ACCEPT",icon:"ion-checkmark-round",action:"accept"},{name:"DECLINE",icon:"ion-minus-circled",action:"decline"}];break;case"App\\Notifications\\newNotifications\\Child\\ReceivedRequestForApplicationNotification":n=[{name:"ACCEPT",icon:"ion-checkmark-round",action:"accept-project-offer"},{name:"PASS",icon:"ion-minus-circled",action:"pass"}];break;case"App\\Notifications\\newNotifications\\Project\\CheckedInNotification":o.hasCheckIn=!0,o.checkIn=t,n=[{name:"START PROJECT",icon:"ion-checkmark-round",action:"check-in"}];break;case"App\\Notifications\\newNotifications\\Child\\CheckInNotification":n=[{name:"COMPLETE",icon:"ion-checkmark-round",action:"complete"}];break;case"App\\Notifications\\newNotifications\\Parent\\RequestForApplicationNotification":n=[{name:"ALLOW",icon:"ion-checkmark-round",action:"allow"},{name:"DENY",icon:"ion-checkmark-round",action:"deny"}]}switch(e){case"App\\Notifications\\newNotifications\\Child\\ReceivedRatingNotification":break;case"App\\Notifications\\newNotifications\\Child\\ApplicantAcceptedNotification":break;case"App\\Notifications\\newNotifications\\Homeowner\\ApplicantAcceptedNotification":break;case"App\\Notifications\\newNotifications\\Project\\CheckInNotification":break;case"App\\Notifications\\newNotifications\\Homeowner\\ApplicantDeclinedNotification":}return n},e.cardRightAction=function(e){},e.navigateToProjects=function(){return"#/app/parent/chores"};var I="";I=o.isParent()?l.uid:l.child["member-id"],m.getNotificationsFromFB(I).then(function(o){e.notifications=o,e.cycleNotifications(),e.notifications.$watch(function(o){e.cycleNotifications()})}),e.cycleNotifications=function(){0==e.notifications.length?e.isEmpty=!0:e.isEmpty=!1;for(var o=0;o<e.notifications.length;o++)"undefined"==typeof e.notifications[o].read_at||""==e.notifications[o].read_at?(e.notifications[o].animate="zoomIn",e.notifications[o].isActionCard=e.actionOrInfoCard(e.notifications[o].type),e.notifications[o].isActionCard?e.notifications[o].cardclass="actioncard":e.notifications[o].cardclass="infocard",e.notifications[o].actions=e.generateActions(e.notifications[o].type,e.notifications[o]),e.notifications[o].cardRightAction=e.cardRightAction(e.notifications[o])):e.notifications.$remove(e.notifications[o])},o.isParent()?y.getProfileFromFB(l.uid).then(function(o){console.log(o),e.profile=o,e.balance={number_of_total_projects:e.profile.num_of_total_projects,number_of_completed_projects:e.profile.num_of_completed_projects,avg_review_score:e.profile.avg_review_score},e.$watch("profile",function(o,t){o!=t&&(e.balance={number_of_total_projects:e.profile.num_of_total_projects,number_of_completed_projects:e.profile.num_of_completed_projects,avg_review_score:e.profile.avg_review_score})})}):(v.getProfileFromFB(l.child["member-id"]).then(function(o){e.profile=o}),b.getChildBalanceForParent(l.child["member-id"]).then(function(o){e.balance=o})),e.profile={rank:"",name:"",num_of_total_projects:0,num_of_completed_projects:0,avg_review_score:0}}]),appControllers.controller("profileCtrl",["$scope","$state","$rootScope","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","ChildService","$http","NotificationService","ParentService",function(e,o,t,n,r,i,a,c,s,l,d,p,u){t.isParent()?(e.profile=c.parent,e.identity={},u.getIdentity(c.uid).then(function(o){e.identity=o})):(e.profile=c.child,e.memberId=e.profile["member-id"]),e.getQRImageLink=function(){if("undefined"!=typeof e.memberId){var o=new QRious({value:e.memberId}),t=o.toDataURL();return t}},e.updateResume=function(){e.showLoader(),l.updateResume(e.profile["member-id"],e.profile.resume).then(function(o){s.hide(),e.showSuccessPopup("Hooray!","Success message goes here")},function(o){s.hide(),e.showErrorPopup("Oops!","Error message goes here")})},e.newauth={password:"",confirm:""},e.isCompletedPassword=function(){return""!=e.newauth.password&&""!=e.newauth.confirm},e.updatePassword=function(){return e.showLoader(),e.newauth.password!=e.newauth.confirm?(s.hide(),void t.showPopup("Password mismatch","The password you entered does not match the confirm password.")):(console.log(e.profile),void(t.isParent()?firebase.auth().currentUser.updatePassword(e.newauth.password).then(function(e){s.hide(),t.showPopup("Password updated","Your password has been updated.")},function(e){s.hide(),t.showPopup("Problem updating",e.message)}):l.updatePassword(e.profile["member-id"],e.newauth.password,e.newauth.confirm).then(function(o){s.hide(),e.showPopup("Password updated","Your password has been updated.")},function(e){s.hide(),t.showPopup("Unable to update password","This could be related to a system error, please try again later.","error")})))},e.printCards=function(){window.isBrowserMode||window.cordova&&cordova.plugins.printer.print("http://api.kidzforce.com/business_cards/print.php?design=1&name=John+Doe&home_phone=(555)+555-5555&cell_phone=(444)+444-4444&work_phone=(333)+333-3333&website=jamescostian.com&company=Local+pawn+shop&position=CEO&skype=jamescostian&email=james%40jamescostian.com&location=Silicon+Valley%2C+CA")},e.purchasePremium=function(){t.showLoader(),ProductsService.purchaseProduct("com.riveloper.KIDZ-BIZ-101.promo_pack").then(function(e){s.hide(),console.log(e)},function(e){s.hide(),console.error(e)})},e.updateAccount=function(){t.verifyIdentityToAddProject=!1,t.showVerifyIdentityModal()},e.countryCode="US",e.onAddressSelection=function(o){e.profile.home_address=o.formatted_address}}]),appControllers.controller("paymentMethodsCtrl",["$scope","$rootScope","$ionicPopup","$ionicLoading","$timeout",function(e,o,t,n,r){e.paymentMethods=[{icon:"https://sandbox.braintreegateway.com/images/payment_instrument_images/visa.png",masked:"**** **** **** 1234",card:"",exp:"01/20",cvc:"123",name:"Austin Sweat"}],e.currentSelectedPaymentMethod={},e.managePopup=null,e.managePaymentMethod=function(o){e.currentSelectedPaymentMethod=o,e.managePopup=t.show({template:'<div class="list"><label class="item item-input"><span class="input-label">Name</span><input type="text" ng-model="currentSelectedPaymentMethod.name"></label><label class="item item-input"><span class="input-label">Card</span><input type="text" placeholder="{{currentSelectedPaymentMethod.masked}}" ng-model="currentSelectedPaymentMethod.card"></label><label class="item item-input"><span class="input-label">Exp</span><input type="text" ng-model="currentSelectedPaymentMethod.exp"></label><label class="item item-input"><span class="input-label">CVC</span><input type="text" ng-model="currentSelectedPaymentMethod.cvc"></label></div><button class="button button-full button-positive" ng-click="savePaymentMethod(currentSelectedPaymentMethod)">Save</button></div><button class="button button-full button-assertive" ng-click="deletePaymentMethod(currentSelectedPaymentMethod)">Delete</button></div>',title:"Manage Visa 1234",subTitle:"You can delete this payment method.",scope:e,buttons:[]}),e.managePopup.then(function(e){})},e.savePaymentMethod=function(o){console.log(o),n.show(),r(function(){n.hide(),e.managePopup.close()},1e3)},e.deletePaymentMethod=function(o){console.log(o),n.show(),r(function(){n.hide(),e.managePopup.close()},1e3)}}]),appControllers.controller("reportCtrl",["$scope","$rootScope","$state","ChildService","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","NotificationService",function(e,o,t,n,r,i,a,c,s,l,d,p,u){e.params=o.help,e.sendReport=function(){o.showPopup("Report Filed","We have filed your report and will be in contact shortly.").then(function(){o.modal.hide()})}}]),appControllers.controller("reviewsCtrl",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","$firebaseAuth","$cordovaOauth","ChildService","$sce","$compile",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f,g){e.reviews=[],e.projects={},o.showLoader(),h.getReviews(o.childId).then(function(o){e.reviews=o,l.hide();for(var t=0;t<e.reviews.length;t++){var n=e.reviews[t];ProjectService.getChoreById(n.project).then(function(o){e.projects[n.project]=e.projects.concat(o)})}},function(e){console.error(e)}),e._calculateAge=function(e){var o=Date.now()-e.getTime(),t=new Date(o);return Math.abs(t.getUTCFullYear()-1970)},h.getProfileFromFB(o.childId).then(function(o){e.profile=o,e.profile.age=e._calculateAge(new Date(e.profile.dob))})}]),appControllers.controller("rewardCtrl",["$scope","$rootScope","$state","ChildService","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","NotificationService","ChildrenService","ProjectService",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h){e.profile=s.child,e.rewards=[],e.allRewards=[],e.itteration=1,e.moreDataAvailable=!0,e.reload=function(){if(0==Object.keys(e.allRewards).length)n.getRewards().then(function(o){e.allRewards=o,e.reload()},function(e){});else{if(Object.keys(e.allRewards).length!=Object.keys(e.rewards).length){0==e.itteration?(e.start=0,e.end=5):(e.start=5*(e.itteration-1),e.end=5*e.itteration);for(var o=e.allRewards.slice(e.start,e.end),t=0;t<Object.keys(o).length;t++)e.rewards=e.rewards.concat(o[t])}else e.moreDataAvailable=!1;e.itteration+=1}l.hide(),e.$broadcast("scroll.infiniteScrollComplete")},e.showLoader(),e.reload(),e.redeemReward=function(e){o.showLoader(),n.requestReward(e).then(function(e){l.hide(),o.showPopup("Reward Redeemed","We have sent your reward to your parents email.","")},function(e){l.hide(),o.showPopup("Unable to reward","This could be related to a system error, please try again later.","error")})},e.deposit=function(){n.requestDeposit().then(function(t){e.profile.num_of_cash=0,o.showPopup("Deposit complete","Your transaction is completed, funds will be available in 1 - 3 business days.","")},function(e){o.showPopup("Unable to deposit","This could be related to a system error, please try again later.","error")})},m.getChildBalanceForParent(s.child["member-id"]).then(function(o){e.balance=o}),e.reviews=[],e.projects={},o.showLoader(),n.getReviews(s.child["member-id"]).then(function(o){e.reviews=o,l.hide();for(var t=0;t<e.reviews.length;t++){var n=e.reviews[t];console.log(n),h.getChoreById(n.project).then(function(o){console.log(o),e.projects[n.project]=o})}},function(e){console.error(e)})}]),appControllers.controller("viewProjectCtrl",["$scope","$state","$rootScope","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","NotificationService","ChildService","ParentService","ProjectService","$ionicScrollDelegate",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f){t.isParent()?e.uid=c.uid:(e.uid=c.child["member-id"],u.getProfileFromFB(c.child["member-id"]).then(function(o){e.profile=o,u.getProjectApplications(c.child["member-id"]).then(function(o){e.applications=o})})),console.log(t.projectViewId),h.getChoreById(t.projectViewId).then(function(o){e.project=o}),e.hasApplied=function(o){for(var t=0;t<e.applications.length;t++)if(e.applications[t].project_id==o)return!0;return!1},e.manageProject=function(e){if(window.isBrowserMode||!window.cordova);else{var o={androidTheme:window.plugins.actionsheet.ANDROID_THEMES.THEME_DEVICE_DEFAULT_LIGHT,title:"What do you want to do with this chore?",buttonLabels:["Edit Project"],addCancelButtonWithLabel:"Cancel",androidEnableCancelButton:!0,winphoneEnableCancelButton:!0,addDestructiveButtonWithLabel:"Cancel Chore",destructiveButtonLast:!0};window.plugins.actionsheet.show(o,function(o){if(o-1==0)t.showEditProjectModal(e);else if(o-1==1){var r=n.confirm({title:"Cancel Chore?",template:"Are you sure you want to cancel this chore? This can not be undone."});r.then(function(o){o&&(t.showLoader(),h.deleteProject(e).then(function(){s.hide(),t.showPopup("Chore deleted","This chore has been deleted.")},function(){s.hide(),t.showPopup("Unable to delete chore","We were unable to delete this chore. This could be related to a system error, please try again later.","error")}))})}})}},e.reportChore=function(e){t.showPopup("Reported","This chore has been flagged and is awaiting review by an Administrator.","error")},e.apply=function(o){e.showLoader(),e.applying=!0,u.applyForChore(o).then(function(o){s.hide(),e.applying=!1,e.showPopup("Awaiting Approval","We have sent your request to the poster. We will notify you when they respond. ")},function(o){s.hide(),console.log(o),e.applying=!1,t.showPopup("Unable to apply","This could be related to a system error, please try again later.","error")})},e.projectStage=function(e,o){return"posted"==e&&(e=1),"accepted"==e&&(e=2),"started"==e&&(e=3),"reviewed"==e&&(e=4),"completed"==e&&(e=5),e>=o?"assertive":"light"}}]),appControllers.controller("menuPlusCtrl",["$scope","$rootScope",function(e,o){e.multiActionActive=!1,e.activateMultiAction=function(){e.multiActionActive=!e.multiActionActive},e.multiActionActiveCheck=function(){return e.multiActionActive?"active":"inactive"}}]).controller("webCtrl",["$scope","$rootScope","$state","$stateParams","$ionicPopup","$ionicHistory","$cordovaInAppBrowser","ENDPOINT_LIST","$localStorage","$ionicLoading","AuthService","$http","$firebaseAuth","$cordovaOauth","ParentService","$sce","$compile","ProjectService",function(e,o,t,n,r,i,a,c,s,l,d,p,u,m,h,f,g,w){o.content="",o.showHomeSection=!0,null!=firebase.auth().currentUser&&(s.checked||(o.showLoader(),d.checkIfEmailExists(firebase.auth().currentUser.email).then(function(e){l.hide(),s.checked=!1,d.reset()},function(e){l.hide(),s.checked=!0}))),e.loadInit=function(){o.showLoader(),p.get(location.origin+"/app/api/parent/dashboard?api_token="+encodeURIComponent(s.uid),{}).then(function(e){l.hide(),o.content=f.trustAsHtml(e.data),o.showHomeSection=!1,setTimeout(function(){var e=$("ion-tabs");angular.element($('[ng-controller="webCtrl"]')).injector().invoke(function(o){var t=angular.element($('[ng-controller="webCtrl"]')).scope();o(e)(t),t.$digest()})},200),setTimeout(function(){var e=$('[ng-controller="notificationCtrl"]');angular.element($('[ng-controller="webCtrl"]')).injector().invoke(function(o){var t=angular.element($('[ng-controller="webCtrl"]')).scope();o(e)(t),t.$digest()}),setTimeout(function(){var e=$('[ng-controller="choresCtrl"]');angular.element($('[ng-controller="webCtrl"]')).injector().invoke(function(o){var t=angular.element($('[ng-controller="webCtrl"]')).scope();o(e)(t),t.$digest()})},200),setTimeout(function(){var e=$('[ng-controller="childrenCtrl"]');angular.element($('[ng-controller="webCtrl"]')).injector().invoke(function(o){var t=angular.element($('[ng-controller="webCtrl"]')).scope();o(e)(t),t.$digest()})},200),setTimeout(function(){var e=$("[ng-init=\"initMap('googlemaps2')\"]");angular.element($('[ng-controller="webCtrl"]')).injector().invoke(function(o){var t=angular.element($('[ng-controller="webCtrl"]')).scope();o(e)(t),t.$digest()})},200)},200)})},e.initMap=function(t){o.isParent()?"undefined"==typeof s.parent.home||null==s.parent.home?e.home=[0,0]:e.home=[s.parent.home.lat,s.parent.home.lng]:e.home=[s.child.home.lat,s.child.home.lng],e.home=[34.093762,-83.723869];var n=new google.maps.LatLng(e.home[0],e.home[1]),r={center:n,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:16,scrollwheel:!1,panControl:!1,zoomControl:!1,scaleControl:!1,mapTypeControl:!1,streetViewControl:!1,styles:o.mapStyle};setTimeout(function(){var o=new google.maps.Map(document.getElementById(t),r);new google.maps.Marker({position:n,map:o,icon:"app/int-test/img/icons/home-marker.png",animation:google.maps.Animation.DROP});e.map=o;var i=firebase.database().ref().child("chore-locations"),a=new GeoFire(i);geoQuery=a.query({
center:[e.home[0],e.home[1]],radius:322})},200)},e.multiActionActive=!1,e.activateMultiAction=function(){e.multiActionActive=!e.multiActionActive},e.multiActionActiveCheck=function(){return e.multiActionActive?"active":"inactive"}}]);